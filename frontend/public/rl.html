<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Force viewport to 1920x1080 for fixed layout -->
    <meta name="viewport" content="width=1920, height=1080, initial-scale=1.0">
    <title>Dnevni Raspored Letova</title>
    <style>
        /* Redizajniran CSS za rl.html - Fiksni Layout, Tamno Plava Tema, Glassmorphism */

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 1080px; /* Fiksna visina */
            width: 1920px; /* Fiksna širina */
            overflow: hidden; /* Nema skrolovanja */
            background-color: #020617; /* Very dark blue */
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            color: #e2e8f0; /* Light grayish blue */
            box-sizing: border-box;
        }

        /* Main container */
        .public-schedule-container {
            height: 100%;
            width: 100%;
            padding: 30px 40px; /* Više paddinga */
            /* Creative radial gradient */
            background: radial-gradient(ellipse at top, #1a2a6c 0%, #0b0f19 60%, #020617 100%);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            position: relative;
        }

         /* Optional subtle background pattern */
        .public-schedule-container::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(rgba(203, 213, 225, 0.03) 1px, transparent 1px);
            background-size: 25px 25px;
            opacity: 0.5;
            z-index: 0;
        }

        /* Header for Departures Title and Date/Time */
        .departures-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 15px; /* Space below header */
            flex-shrink: 0;
            position: relative; /* Ensure content stays above background pattern */
            z-index: 1;
        }

        /* Header for Arrivals Title */
        .arrivals-header {
            display: flex; /* Keep flex for potential future elements */
            justify-content: flex-start; /* Align title left */
            align-items: center;
            width: 100%;
            margin-top: 25px; /* Space above arrivals header */
            margin-bottom: 15px; /* Space below header */
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }


        .schedule-datetime {
            text-align: right;
            font-size: 26px;
            font-weight: 400;
            color: #94a3b8; /* Lighter gray-blue */
        }
         .schedule-datetime span { display: block; }
         #current-time-display { font-weight: 600; color: #e2e8f0; font-size: 30px; }


        /* Section title styling */
        .public-section-title {
            font-size: 34px;
            color: #e0f2fe; /* Light sky blue */
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
            font-weight: 500;
            margin: 0;
            text-transform: uppercase;
        }
         .public-section-title svg {
             width: 30px;
             height: 30px;
             fill: #64b5f6; /* Light blue icon */
         }


        /* Sections container */
        .public-schedule-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            flex-grow: 1; /* Takes remaining vertical space */
            overflow: hidden; /* Hide overflow */
            position: relative; /* Ensure content stays above background pattern */
            z-index: 1;
        }

        /* Individual section styling (Departures/Arrivals) */
        .public-departures,
        .public-arrivals {
            background: rgba(30, 41, 59, 0.6); /* Slightly more opaque glass */
            border: 1px solid rgba(51, 65, 85, 0.5); /* Slate border */
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            flex-basis: 0; /* Equal height distribution */
            flex-grow: 1; /* Grow to fill space */
            overflow: hidden; /* Hide overflow */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5); /* Increased shadow */
            backdrop-filter: blur(20px); /* Further increased blur */
            -webkit-backdrop-filter: blur(20px);
        }

        /* Table container - no scroll */
        .table-container {
            flex-grow: 1;
            overflow: hidden; /* No scroll */
            position: relative;
        }

        /* Table styling */
        .public-flight-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            table-layout: fixed;
        }

        /* Column widths - adjust percentages/pixels for 1920 width */
        .narrow-column { width: 4%; text-align: center; }
        .brojleta { width: 10%; text-align: center; }
        .airline-col { width: 20%; }
        .vrijeme { width: 8%; text-align: center; }
        .destination-col { width: 38%; } /* More space for destination */
        .remarks-col { width: 20%; }


        /* Table header */
        .public-flight-table th {
            background: linear-gradient(to bottom, rgba(51, 65, 85, 0.8), rgba(30, 41, 59, 0.9)); /* Darker blue gradient */
            color: #cbd5e1; /* Lighter text */
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 14px 12px; /* Adjust padding */
            text-align: center;
            border-bottom: 1px solid rgba(71, 85, 105, 0.6); /* Stronger border */
            font-size: 18px; /* Slightly smaller header font */
            position: sticky;
            top: 0;
            z-index: 2;
        }
         .public-flight-table th:first-child { border-top-left-radius: 10px; }
         .public-flight-table th:last-child { border-top-right-radius: 10px; }


        /* Table cells */
        .public-flight-table td {
            padding: 12px 12px; /* Adjust padding */
            text-align: center; /* Center text by default */
            border-bottom: 1px solid rgba(51, 65, 85, 0.4); /* Subtle border */
            word-wrap: break-word;
            vertical-align: middle;
            font-size: 22px; /* Adjust font size */
            background-color: transparent; /* Let section background show through */
            color: #e2e8f0;
            height: 55px; /* Approximate height per row - adjust as needed */
            box-sizing: border-box;
        }

        /* Left-align airline column specifically */
        .public-flight-table td.airline-col {
            text-align: left;
        }

        /* Alternating row styling */
        .public-flight-table tbody tr:nth-of-type(even) td {
            background-color: rgba(51, 65, 85, 0.15); /* Slightly more visible alternating row */
        }

        /* Hover effect - less important for display screens */
        /* .public-flight-table tbody tr:hover td {
            background-color: rgba(100, 181, 246, 0.08);
        } */

        /* Airline info */
        .public-airline-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Airline logo */
        .public-airline-logo {
            width: 50px; /* Adjust size as needed */
            height: 35px; /* Fixed height for cover */
            max-height: 35px; /* Limit height */
            border-radius: 10px; /* Updated border radius */
            object-fit: cover; /* Use cover */
            vertical-align: middle;
            background-color: rgba(255, 255, 255, 0.05);
            padding: 2px;
            border: 1px solid rgba(100, 181, 246, 0.2);
        }

        /* Specific text styles */
        .destination1, .dolazak1, .bilješke1, .brojleta1 {
            font-size: 22px; /* Adjusted font size */
            font-weight: 400;
        }
        .brojleta1 { font-family: 'Consolas', 'Menlo', monospace; color: #94a3b8; }
        .dolazak1 { color: #f1f5f9; font-weight: 600; }
        .destination1 { font-weight: 500; color: #ffffff; }
        .bilješke1 { color: #94a3b8; font-style: italic; }

        /* Loading spinner */
        .public-spinner {
            display: block;
            margin: 40px auto;
            width: 45px;
            height: 45px;
            border: 4px solid rgba(100, 181, 246, 0.2);
            border-radius: 50%;
            border-top-color: #64b5f6;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Error message */
        .public-error {
            text-align: center;
            margin: 40px auto;
            max-width: 600px;
            padding: 20px;
            background: rgba(239, 83, 80, 0.1);
            border-left: 4px solid #ef5350;
            border-radius: 8px;
            color: #ef9a9a;
            font-size: 18px;
        }

        /* Hide elements */
        .hidden { display: none !important; }

    </style>
</head>
<body>
    <div class="public-schedule-container">

        <!-- Header for Departures and Time -->
        <div class="departures-header">
             <h2 class="public-section-title">
                 <!-- Departure SVG Icon -->
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="30px" height="30px">
                    <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
                 </svg>
                 ODLASCI / DEPARTURES
             </h2>
            <div class="schedule-datetime">
                <span id="current-time-display">--:--</span>
                <span id="current-date-display">--.--.----</span>
            </div>
        </div>

        <div id="loading-indicator" class="public-spinner hidden"></div>
        <div id="error-message" class="public-error hidden"></div>

        <!-- Content Area (Tables) -->
        <div class="public-schedule-content">
            <!-- Departures Section -->
            <div class="public-departures">
                <div class="table-container">
                    <table class="public-flight-table">
                        <thead>
                            <tr>
                                <th class="narrow-column">BR.</th>
                                <th class="brojleta">LET/FLIGHT</th>
                                <th class="airline-col">AVIOKOMPANIJA/AIRLINES</th>
                                <th class="vrijeme">VRIJEME/TIME</th>
                                <th class="destination-col">ODREDIŠTE/DESTINATION</th>
                                <th class="remarks-col">BILJEŠKE/REMARKS</th>
                            </tr>
                        </thead>
                        <tbody id="departures-body">
                            <!-- Rows will be added here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

             <!-- Header for Arrivals -->
             <div class="arrivals-header">
                 <h2 class="public-section-title">
                     <!-- Arrival SVG Icon -->
                     <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="30px" height="30px">
                        <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z" transform="rotate(180 12 12)"/>
                     </svg>
                     DOLASCI / ARRIVALS
                 </h2>
             </div>

            <!-- Arrivals Section -->
            <div class="public-arrivals">
                <div class="table-container">
                    <table class="public-flight-table">
                        <thead>
                            <tr>
                                <th class="narrow-column">BR.</th>
                                <th class="brojleta">LET/FLIGHT</th>
                                <th class="airline-col">AVIOKOMPANIJA/AIRLINES</th>
                                <th class="vrijeme">VRIJEME/TIME</th>
                                <th class="destination-col">ODREDIŠTE/DESTINATION</th>
                                <th class="remarks-col">BILJEŠKE/REMARKS</th>
                            </tr>
                        </thead>
                        <tbody id="arrivals-body">
                            <!-- Rows will be added here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // --- Configuration ---
            var API_BASE_URL = 'https://fids-hqlz.onrender.com';
            var API_URL = API_BASE_URL + '/api/public/daily-schedule';
            var REFRESH_INTERVAL = 120000; // 2 minutes
            // FLIGHTS_PER_PAGE: Adjust this value based on visual testing on the 1920x1080 screen.
            // Consider header height, padding, row height (including padding), and spacing between tables.
            // Start with an estimate (e.g., 8) and fine-tune.
            var FLIGHTS_PER_PAGE = 8; // ESTIMATE - ADJUST BASED ON ACTUAL DISPLAY
            var DEFAULT_LOGO = '/default-logo.png'; // Consider creating a simple default logo

            // --- State ---
            var allFlights = [];
            // Rotation is disabled for fixed layout
            // var visibleDeparturesIndex = 0;
            // var visibleArrivalsIndex = 0;
            // var shouldRotate = false;
            // var rotationIntervalId = null;

            // --- DOM Elements ---
            var timeDisplay = document.getElementById('current-time-display');
            var dateDisplay = document.getElementById('current-date-display');
            var departuresTableBody = document.getElementById('departures-body');
            var arrivalsTableBody = document.getElementById('arrivals-body');
            var loadingIndicator = document.getElementById('loading-indicator');
            var errorMessage = document.getElementById('error-message');

            // --- Utility Functions ---
            function padStart(str, targetLength, padString) {
                str = String(str);
                padString = String(padString || ' ');
                if (str.length >= targetLength) { return str; }
                var padding = padString;
                while (padding.length < targetLength - str.length) { padding += padString; }
                return padding.slice(0, targetLength - str.length) + str;
            }

            function formatDateTimeForDisplay(date) {
                var hours = padStart(date.getHours(), 2, '0');
                var minutes = padStart(date.getMinutes(), 2, '0');
                var day = padStart(date.getDate(), 2, '0');
                var month = padStart(date.getMonth() + 1, 2, '0'); // Months are 0-indexed
                var year = date.getFullYear();
                if (timeDisplay) timeDisplay.textContent = hours + ':' + minutes;
                if (dateDisplay) dateDisplay.textContent = day + '.' + month + '.' + year;
            }

            function formatTimeHoursMinutes(dateString) {
                try {
                    var date = new Date(dateString);
                    // Check if date is valid
                    if (isNaN(date.getTime())) {
                        console.warn("Invalid date string received:", dateString);
                        return '--:--';
                    }
                    var hours = padStart(date.getHours(), 2, '0');
                    var minutes = padStart(date.getMinutes(), 2, '0');
                    return hours + ':' + minutes;
                } catch (e) {
                    console.error("Error formatting time:", dateString, e);
                    return '--:--';
                }
            }

            function showLoading() {
                if (loadingIndicator) loadingIndicator.classList.remove('hidden');
                if (errorMessage) errorMessage.classList.add('hidden');
            }

            function showError(message) {
                if (errorMessage) {
                    errorMessage.textContent = message;
                    errorMessage.classList.remove('hidden');
                }
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
            }

            function hideStatus() {
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
                if (errorMessage) errorMessage.classList.add('hidden');
            }

            // --- Clock Update ---
            function updateClock() {
                formatDateTimeForDisplay(new Date());
            }

            // --- Data Fetching ---
            function fetchData() {
                console.log('Fetching flight data...');
                showLoading();

                var xhr = new XMLHttpRequest();
                // Add cache-busting parameter
                var urlWithCacheBuster = API_URL + '?t=' + Date.now();
                xhr.open('GET', urlWithCacheBuster, true);
                xhr.timeout = 15000; // Set timeout (15 seconds)

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            try {
                                var data = JSON.parse(xhr.responseText);
                                if (Array.isArray(data)) {
                                    allFlights = data;
                                    hideStatus();
                                    updateTables(); // Update tables with new data
                                    // Rotation setup is removed
                                } else {
                                    console.error('Invalid data format received:', data);
                                    showError('Greška: Neočekivani format podataka.');
                                }
                            } catch (err) {
                                console.error('Greška pri parsiranju JSON-a:', err, xhr.responseText);
                                showError('Greška pri obradi podataka.');
                            }
                        } else {
                            console.error('Greška pri dobavljanju dnevnih letova:', xhr.status, xhr.statusText);
                            showError('Greška pri dobavljanju podataka (' + xhr.status + '). Pokušavam ponovo...');
                            // Optional: Implement retry logic here if needed
                        }
                    }
                };
                xhr.onerror = function() {
                    console.error('Network error occurred');
                    showError('Mrežna greška pri dobavljanju podataka. Proverite konekciju.');
                };
                xhr.ontimeout = function () {
                    console.error('Request timed out');
                    showError('Zahtev je istekao. Pokušavam ponovo...');
                };
                xhr.send();
            }

            // --- Table Rendering ---
            function renderTableRows(tbodyElement, flightsToShow, startIndex) {
                tbodyElement.innerHTML = ''; // Clear existing rows

                for (var i = 0; i < flightsToShow.length; i++) {
                    var flight = flightsToShow[i];
                    var row = document.createElement('tr');
                    var airlineName = flight.Airline ? flight.Airline.name : 'N/A';
                    // Check if logo_url exists and starts with /uploads/ for relative path
                    var airlineLogoRelativePath = flight.Airline && flight.Airline.logo_url && flight.Airline.logo_url.startsWith('/uploads/')
                        ? flight.Airline.logo_url
                        : null;
                    // Construct full URL if relative, otherwise use the provided URL or default
                    var logoUrl = airlineLogoRelativePath
                        ? API_BASE_URL + airlineLogoRelativePath
                        : (flight.Airline && flight.Airline.logo_url ? flight.Airline.logo_url : DEFAULT_LOGO);

                    var timeString = flight.is_departure ? formatTimeHoursMinutes(flight.departure_time) : formatTimeHoursMinutes(flight.arrival_time);

                    row.innerHTML = '<td class="narrow-column">' + (startIndex + i + 1) + '</td>' +
                                    '<td class="brojleta1">' + (flight.flight_number || '') + '</td>' +
                                    '<td class="airline-col">' +
                                        '<div class="public-airline-info">' +
                                            '<img src="' + logoUrl + '" alt="' + airlineName + '" class="public-airline-logo" onerror="this.onerror=null;this.src=\'' + DEFAULT_LOGO + '\';">' +
                                            '<span>' + airlineName + '</span>' +
                                        '</div>' +
                                    '</td>' +
                                    '<td class="dolazak1">' + timeString + '</td>' +
                                    '<td class="destination-col destination1">' + (flight.destination || '') + '</td>' +
                                    '<td class="remarks-col bilješke1">' + (flight.remarks || '') + '</td>';
                    tbodyElement.appendChild(row);
                }

                // Add empty rows if needed to fill up to FLIGHTS_PER_PAGE
                var emptyRowCount = FLIGHTS_PER_PAGE - flightsToShow.length;
                for (var j = 0; j < emptyRowCount; j++) {
                    var emptyRow = document.createElement('tr');
                    // Use &nbsp; or specific styling for empty rows to maintain height
                    emptyRow.innerHTML = '<td colspan="6" style="height: 55px; border-bottom: 1px solid rgba(51, 65, 85, 0.4);">&nbsp;</td>'; // Match cell height
                    // Apply alternating background based on the index relative to *all* rows (data + empty)
                    if ((flightsToShow.length + j) % 2 !== 0) {
                         emptyRow.style.backgroundColor = 'rgba(51, 65, 85, 0.15)';
                    }
                    tbodyElement.appendChild(emptyRow);
                }
            }


            function updateTables() {
                var departures = [];
                var arrivals = [];
                for (var i = 0; i < allFlights.length; i++) {
                    if (allFlights[i].is_departure) departures.push(allFlights[i]);
                    else arrivals.push(allFlights[i]);
                }

                // Display only the first FLIGHTS_PER_PAGE flights
                var visibleDepartureFlights = departures.slice(0, FLIGHTS_PER_PAGE);
                var visibleArrivalFlights = arrivals.slice(0, FLIGHTS_PER_PAGE);

                renderTableRows(departuresTableBody, visibleDepartureFlights, 0); // Start index is 0
                renderTableRows(arrivalsTableBody, visibleArrivalFlights, 0);   // Start index is 0

                console.log('Tables updated with fixed rows.');
            }

            // --- Rotation Logic (DISABLED) ---
            /*
            function rotateFlights() {
                // This function is no longer needed for fixed layout
            }

            function setupRotation() {
                // This function is no longer needed for fixed layout
            }
            */

            // --- Initialization ---
            if (!departuresTableBody || !arrivalsTableBody || !timeDisplay || !dateDisplay) {
                console.error("Critical DOM elements not found. Aborting initialization.");
                showError("Greška pri inicijalizaciji prikaza.");
                return; // Stop execution if essential elements are missing
            }

            updateClock(); // Initial clock update
            setInterval(updateClock, 1000); // Update clock every second

            fetchData(); // Initial data fetch
            setInterval(fetchData, REFRESH_INTERVAL); // Refresh data periodically

            console.log('Flight schedule display initialized for fixed layout.');

        })();
    </script>
</body>
</html>
