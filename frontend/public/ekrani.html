<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Force viewport to 1920x1080 for fixed layout -->
    <meta name="viewport" content="width=1920, height=1080, initial-scale=1.0">
    <title>Check-In Display</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        /* ekrani.html - Redizajn za Check-In */

        html, body {
            margin: 0;
            padding: 0;
            height: 1080px; /* Fiksna visina */
            width: 1920px; /* Fiksna širina */
            overflow: hidden; /* Nema skrolovanja */
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            color: #e2e8f0; /* Light grayish blue */
            /* Background gradient from rl.html */
            background: radial-gradient(ellipse at top, #1a2a6c 0%, #0b0f19 60%, #020617 100%);
            display: flex;
            align-items: center; /* Center vertically */
            justify-content: center; /* Center horizontally */
            box-sizing: border-box;
        }

        /* Main container for all content types */
        #content-root {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        /* Check-In Specific Container */
        .checkin-display-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            box-sizing: border-box;
            position: relative; /* For absolute positioning of time/date */
        }

        /* Glassmorphism Card */
        .checkin-card {
            background: rgba(0, 0, 0, 0); /* Glass background */
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 24px; /* Larger radius */
            padding: 90px 70px 50px 70px; /* Increased top padding further */
            width: 75%; /* Adjust width as needed */
            max-width: 1400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: inset 0 0 10px rgba(66, 153, 225, 0.3), 0 15px 35px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(96, 165, 250, 0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            text-align: center;
            position: relative; /* For priority banner */
            z-index: 1;
        }

        /* Priority Banner */
        .priority-banner {
            position: absolute;
            top: -40px; /* Adjust top position further */
            left: 0; /* Align to the left edge of the card */
            width: 100%; /* Make it full width of the card */
            transform: translateX(0); /* Remove horizontal transform */
            padding: 25px 0; /* Increased vertical padding further */
            background-color: #dc3545; /* Bright red */
            color: white;
            font-size: 48px; /* Even larger font */
            font-weight: 700;
            /* Keep top corners rounded, bottom corners sharp to merge visually */
            border-radius: 24px 24px 0 0; /* Match card's top radius */
            z-index: 10;
            letter-spacing: 2.5px; /* More spacing */
            box-shadow: 0 10px 25px rgba(255, 69, 58, 0.6); /* Even stronger shadow */
            text-align: center; /* Ensure text is centered */
            box-sizing: border-box; /* Include padding in width */
            text-shadow: 0 2px 4px rgba(0,0,0,0.3); /* Add text shadow */
        }

        /* Optional pulse animation for priority */
        /* @keyframes pulse {
            0% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.03); }
            100% { transform: translateX(-50%) scale(1); }
        } */

        /* Header within the card */
        .checkin-header {
            display: flex;
            align-items: center;
            justify-content: center; /* Center logo and name */
            gap: 30px;
            margin-bottom: 30px;
            width: 100%;
        }

        .checkin-airline-logo {
            width: 180px; /* Larger logo */
            height: auto;
            max-height: 100px;
            object-fit: cover;
            border-radius: 15px;
             background-color: rgba(255, 255, 255, 0.05);
            padding: 5px;
            border: 1px solid rgba(100, 181, 246, 0.2);
        }

        .checkin-airline-name {
            font-size: 55px; /* Larger name */
            font-weight: 600;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Flight Details */
        .checkin-flight-details {
            display: flex;
            justify-content: space-around; /* Space out details */
            width: 100%;
            margin-bottom: 40px;
            padding: 20px 0;
            border-top: 1px solid rgba(71, 85, 105, 0.5);
            border-bottom: 1px solid rgba(71, 85, 105, 0.5);
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .detail-label {
            font-size: 22px;
            font-weight: 500;
            color: #94a3b8; /* Lighter gray-blue */
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .detail-value {
            font-size: 38px;
            font-weight: 700;
            color: #e0f2fe; /* Light sky blue */
        }
         .detail-value.flight-number { /* Specific style for flight number */
             font-family: 'Consolas', 'Menlo', monospace;
         }


        /* Destination */
        .checkin-destination {
            font-size: 95px; /* Very large destination */
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 35px;
            letter-spacing: 2px;
            text-transform: uppercase;
            line-height: 1.1;
        }

        /* Status Label */
        .checkin-status-label {
            font-size: 75px; /* Large status */
            font-weight: 700;
            color: #4ade80; /* Bright Green */
            margin-bottom: 40px;
            letter-spacing: 1px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 20px;
        }
         .checkin-status-label svg { /* Style for potential icon */
             width: 60px;
             height: 60px;
             fill: #4ade80;
         }

        /* Time/Date Display (Top Right Corner) */
        .current-datetime {
            position: absolute;
            top: 30px; /* Adjust top position */
            right: 40px;
            text-align: right;
            z-index: 5; /* Ensure it's above background but below modals if any */
        }

        .current-time {
            font-size: 46px;
            font-weight: 600;
            color: #e0e0ff;
        }

        .current-date {
            font-size: 30px;
            color: #b8c6db;
            margin-top: 4px;
        }

        /* Default/Error/Static Content Styling (Keep simple) */
        .default-content, .error-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        .default-content h1, .error-content h1 {
            font-size: 48px;
            font-weight: 700;
            color: #64D2FF;
            margin-bottom: 20px;
        }
         .error-content h1 {
             color: #FF453A;
         }
        .default-content p, .error-content p {
            font-size: 24px;
            color: #e0f7fa;
            max-width: 700px;
        }
        .default-content .logo {
            max-width: 350px;
            height: auto;
            margin-bottom: 30px;
        }
        .static-image-container {
             width: 100%;
             height: 100%;
             display: flex;
             align-items: center;
             justify-content: center;
        }
        .static-image {
            max-width: 95%; /* Limit size slightly */
            max-height: 95%;
            object-fit: contain; /* Use contain to avoid cropping */
            border-radius: 20px;
        }

        /* Static Content Wrapper and Header */
        .static-content-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column; /* Stack header and image */
            position: relative; /* For absolute positioning of header */
        }
        .static-header-bar {
            position: absolute; /* Position at the top */
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 30px;
            background-color: rgba(2, 6, 23, 0.1); /* Very low opacity background */
            box-sizing: border-box;
            z-index: 10; /* Ensure it's above the image */
            border-bottom: 1px solid rgba(51, 65, 85, 0.3); /* Lighter border */
            font-family: 'Exo 2', sans-serif; /* Apply Exo 2 font to header */
        }
        /* Header Sections */
        .header-left {
            flex-basis: 15%; /* Adjust as needed */
            text-align: left;
            font-size: 60px; /* Larger ID */
            font-weight: 700;
            color: #ffffff;
        }
        .header-middle {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px; /* Space around logo */
        }
        .header-middle .middle-text {
             font-size: 42px;
             font-weight: 600;
             color: #e0f2fe; /* Light sky blue */
        }
        /* .header-logo rule removed */
        .header-right { /* Container for datetime */
             flex-basis: 15%; /* Adjust as needed */
             text-align: right;
        }
        .header-time {
            font-size: 30px; /* Keep size */
            font-weight: 600;
            color: #e0e0ff;
            display: block;
        }
        .header-date {
            font-size: 20px;
            color: #b8c6db;
            display: block;
            margin-top: 2px;
        }
        /* Adjust static image container to account for header */
        .static-image-container {
             width: 100%;
             height: 100%; /* Take full height of its parent */
             display: flex;
             align-items: center;
             justify-content: center;
             padding-top: 80px; /* Add padding to push image below header (adjust as needed) */
             box-sizing: border-box;
        }


        /* Hide elements */
        .hidden {
            display: none !important;
        }

        /* Notification Bar Styles (Keep as is) */
        #notification-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgb(255,191,0); /* Light Sea Green / Teal */
            color: #13445F; /* White text */
            padding: 10px 0;
            overflow: hidden; /* Hide overflowing text */
            white-space: nowrap; /* Keep text on one line */
            box-sizing: border-box;
            z-index: 100; /* Ensure it's on top */
            font-size: 68px; /* Adjust font size as needed */
            font-weight: bold;
        }

        #notification-text {
            display: inline-block; /* Needed for animation */
            padding-left: 100%; /* Start text off-screen to the right */
            animation: marquee 60s linear infinite; /* Adjust duration as needed */
        }

        @keyframes marquee {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); } /* Move text fully to the left */
        }

        /* --- Notice Session Styles --- */
        .notice-status-label {
            font-size: 65px; /* Slightly smaller than checkin/boarding */
            font-weight: 700;
            color: #FFD60A; /* Yellow/Gold color for notice */
            margin-bottom: 25px; /* Space before text box */
            letter-spacing: 1px;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center; /* Center label */
            gap: 20px;
        }
        .notice-icon {
            font-size: 60px; /* Adjust icon size */
            line-height: 1;
        }
        .notice-text-box {
            background-color: rgba(255, 214, 10, 0.1); /* Light yellow background */
            border: 1px solid rgba(255, 214, 10, 0.4);
            border-radius: 16px; /* Slightly larger radius */
            padding: 40px 50px; /* Increased padding (makes it taller and adds horizontal space) */
            margin-top: 15px; /* More space from status label */
            margin-bottom: 40px; /* More space below box */
            width: 95%; /* Make it wider */
            max-width: 1300px; /* Increase max-width */
            min-height: 100px; /* Ensure a minimum height */
            font-size: 60px; /* Increased font size */
            line-height: 1.5; /* Keep line height */
            color: #FFF5CC; /* Light yellow text */
            text-align: left; /* Align text to the left for marquee */
            white-space: nowrap; /* Prevent wrapping */
            overflow: hidden; /* Hide overflowing text */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative; /* Needed for absolute positioning of inner span if required */
        }
        .notice-text-box > span { /* Style for the inner scrolling span */
            display: inline-block;
            padding-left: 100%; /* Start off-screen */
            /* Increased duration to slow down animation (e.g., 25s -> 40s) */
            animation: marquee-inner 60s linear infinite;
            white-space: nowrap; /* Ensure span itself doesn't wrap */
        }

        /* Keyframes for inner marquee */
        @keyframes marquee-inner {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }
        /* --------------------------- */

        /* --- Bento Layout for Static/Default Content --- */
        .bento-container {
            display: flex;
            width: 100%;
            height: 100%;
            padding: 30px; /* Add some padding around the container */
            box-sizing: border-box;
        }
        .bento-left {
            flex-basis: 22%; /* Reduced width slightly */
            display: flex;
            flex-direction: column;
            gap: 35px; /* Increased space between boxes */
            padding-right: 35px; /* Increased space between left and right */
            box-sizing: border-box;
        }
        .bento-right {
            flex-basis: 75%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.03); /* Subtle background for the right area */
            border-radius: 13px;
            overflow: hidden; /* Ensure image stays within bounds */
            padding: 0; /* REMOVED padding */
            box-sizing: border-box;
        }
        .bento-box {
            background: rgba(30, 41, 59, 0.5); /* Slightly less transparent background */
            border: 1px solid rgba(71, 85, 105, 0.6); /* Slightly stronger border */
            border-radius: 13px;
            padding: 30px; 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), inset 0 0 10px rgba(66, 153, 225, 0.2); /* Adjusted shadow */
            backdrop-filter: blur(8px); /* Slightly increased blur */
            -webkit-backdrop-filter: blur(8px);
            color: #e2e8f0;
            font-family: 'Exo 2', sans-serif;
        }
        .bento-box.date-time-box {
            flex-grow: 1; /* Allow this box to take more space if needed */
            min-height: 150px; /* Example min height */
        }
        .bento-box.counter-number-box {
            flex-grow: 2; /* Larger box */
            min-height: 200px; /* Example min height */
            /* Centering restored via align-items and text-align above */
        }
        .bento-box.counter-name-box {
            flex-grow: 1;
            min-height: 150px; /* Example min height */
             /* Centering restored via align-items and text-align above */
        }
        .bento-time {
            font-size: 64px; /* Increased */
            font-weight: 700;
            color: #ffffff;
            display: block;
            margin-bottom: 8px; /* Slightly increased */
        }
        .bento-date {
            font-size: 38px; /* Increased */
            color: #b8c6db;
            display: block;
        }
        .bento-counter-id {
            font-size: 130px; /* Increased */
            font-weight: 800;
            color: #ffffff;
            line-height: 1;
        }
        .bento-counter-name {
            font-size: 46px; /* Increased */
            font-weight: 600;
            color: #e0f2fe;
            line-height: 1.2;
        }
        /* Adjust static image/default content for bento right */
        .bento-right .static-image-container,
        .bento-right .default-content {
            width: 100%;
            height: 100%;
            padding: 0; /* Remove padding if set previously */
        }
        .bento-right .static-image {
            width: 100%; /* Fill width */
            height: 100%; /* Fill height */
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Keep aspect ratio, fit within bounds */
            border-radius: 0; /* Remove radius if set previously, parent has it */
        }
        .bento-right .default-content {
             /* Keep centering */
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
             text-align: center;
        }
        .bento-right .default-content .logo {
            max-width: 300px; /* Adjust size if needed */
            margin-bottom: 25px;
        }
         .bento-right .default-content h1 {
             font-size: 42px;
             margin-bottom: 15px;
         }
         .bento-right .default-content p {
             font-size: 22px;
         }
        /* --------------------------------------------- */

    </style>
</head>
<body>
    <!-- Container for dynamic content -->
    <div id="content-root">
        <!-- Default loading state -->
        <div class="default-content">
            <h1>Učitavanje...</h1>
        </div>
    </div>

    <!-- Notification Bar -->
    <div id="notification-bar" class="hidden">
        <span id="notification-text"></span>
    </div>

    <script>
        (function() {
            // --- Configuration ---
            var API_BASE_URL = 'https://fids-hqlz.onrender.com';
            var REFRESH_INTERVAL = 120000; // Refresh data every 2 minutes
            var DEFAULT_LOGO = '/AerodromMat-logo.png'; // Path relative to public folder

            // --- State ---
            var currentPageId = null;
            var currentSession = null;
            var currentStaticContent = null;
            var currentError = null;
            var currentTime = new Date();

            // --- DOM Elements ---
            var contentRoot = document.getElementById('content-root');
            var notificationBar = document.getElementById('notification-bar');
            var notificationTextElement = document.getElementById('notification-text');

            // --- Utility Functions ---
            function getQueryParam(param) {
                var urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(param);
            }

            function padStart(str, targetLength, padString) {
                str = String(str);
                padString = String(padString || ' ');
                if (str.length >= targetLength) { return str; }
                var padding = padString;
                while (padding.length < targetLength - str.length) { padding += padString; }
                return padding.slice(0, targetLength - str.length) + str;
            }

            function formatDate(date) {
                var day = padStart(date.getDate(), 2, '0');
                var month = padStart(date.getMonth() + 1, 2, '0');
                var year = date.getFullYear();
                return day + '.' + month + '.' + year;
            }

            function formatTime(date) {
                var hours = padStart(date.getHours(), 2, '0');
                var minutes = padStart(date.getMinutes(), 2, '0');
                return hours + ':' + minutes;
            }

             function formatFlightTime(dateString) {
                 try {
                    var date = new Date(dateString);
                    if (isNaN(date.getTime())) { return '--:--'; }
                    return formatTime(date);
                } catch (e) {
                    console.error("Error formatting flight time:", dateString, e);
                    return '--:--';
                }
            }

            // --- Rendering Functions ---
            function renderError(message) {
                contentRoot.innerHTML = '<div class="error-content">' + // Use specific class
                                            '<h1>Greška</h1>' +
                                            '<p>' + (message || 'Došlo je do greške prilikom učitavanja.') + '</p>' +
                                        '</div>';
                 notificationBar.classList.add('hidden');
                 notificationTextElement.textContent = '';
                 notificationTextElement.style.animation = 'none';
            }

            function renderDefaultContent() {
                var contentHTML = '';
                var displayId = currentPageId || 'N/A';
                var middleText = '';
                var pagePrefix = currentPageId ? currentPageId.charAt(0).toUpperCase() : '';
                var pageNumber = currentPageId ? currentPageId.substring(1) : '';

                // Determine Counter ID and Name based on page ID
                if (pagePrefix === 'C') {
                    displayId = currentPageId; // e.g., C1, C2
                    middleText = 'ŠALTER ZA PRIJAVU / CHECK IN COUNTER';
                } else if (pagePrefix === 'U' && !isNaN(parseInt(pageNumber))) {
                    displayId = 'G' + pageNumber; // Convert U1 to G1, U2 to G2 etc.
                    middleText = 'IZLAZ / GATE';
                } else {
                    // Fallback if needed
                    displayId = currentPageId || 'N/A';
                    middleText = 'INFO'; // Default name
                }

                // Build the Bento Layout HTML
                contentHTML = '<div class="bento-container">' +
                                  '<div class="bento-left">' +
                                      // Box 1: Date & Time
                                      '<div class="bento-box date-time-box">' +
                                          '<span class="bento-time">' + formatTime(currentTime) + '</span>' +
                                          '<span class="bento-date">' + formatDate(currentTime) + '</span>' +
                                      '</div>' +
                                      // Box 2: Counter Number
                                      '<div class="bento-box counter-number-box">' +
                                          '<span class="bento-counter-id">' + displayId + '</span>' +
                                      '</div>' +
                                      // Box 3: Counter Name
                                      '<div class="bento-box counter-name-box">' +
                                          '<span class="bento-counter-name">' + middleText + '</span>' +
                                      '</div>' +
                                  '</div>' + // End bento-left
                                  '<div class="bento-right">'; // Start bento-right

                // Add static image or default content to the right side
                if (currentStaticContent && currentStaticContent.imageUrl) {
                    contentHTML += '<div class="static-image-container">' +
                                       '<img src="' + API_BASE_URL + currentStaticContent.imageUrl + '" alt="Statički sadržaj" class="static-image" onerror="this.onerror=null; this.parentElement.innerHTML = \'<div class=default-content><h1>Greška pri učitavanju slike</h1></div>\';">' +
                                   '</div>';
                } else {
                    // Render default welcome message inside bento-right
                    contentHTML += '<div class="default-content">' +
                                       '<img src="' + DEFAULT_LOGO + '" alt="SkyLine Logo" class="logo" onerror="this.onerror=null;this.src=\'https://via.placeholder.com/300x100?text=SkyLine\';">' +
                                       '<h1>Dobrodošli na Međunarodni Aerodrom Tuzla</h1>' +
                                       '<p>Trenutno nema aktivnih informacija za prikaz.</p>' +
                                   '</div>';
                }

                contentHTML += '</div>' + // End bento-right
                             '</div>'; // End bento-container

                contentRoot.innerHTML = contentHTML;
                notificationBar.classList.add('hidden');
                notificationTextElement.textContent = '';
                notificationTextElement.style.animation = 'none';
            }


            // *** NEW Check-In Rendering Function ***
            function renderCheckInContent() {
                 var displayData = currentSession.CustomFlightData || currentSession.Flight;
                 if (!currentSession || !displayData) {
                    renderDefaultContent();
                    return;
                 }

                 var airline = displayData.Airline;
                 var flightTimeValue = displayData.is_departure ? displayData.departure_time : displayData.arrival_time;
                 var formattedFlightTimeValue = formatFlightTime(flightTimeValue);
                 var airlineLogoRelativePath = airline && airline.logo_url && airline.logo_url.startsWith('/uploads/') ? airline.logo_url : null;
                 var airlineLogoUrl = airlineLogoRelativePath ? API_BASE_URL + airlineLogoRelativePath : (airline && airline.logo_url ? airline.logo_url : DEFAULT_LOGO);
                 var airlineName = airline ? airline.name : 'Nepoznata Aviokompanija';
                 var flightNumber = displayData.flight_number || '';
                 var destination = displayData.destination || '';

                 var priorityBannerHTML = currentSession.isPriority ? '<div class="priority-banner">PRIORITY</div>' : '';

                 // Check-in Icon (Example using SVG)
                 var checkinIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>';

                 var contentHTML = '<div class="checkin-display-container">' +
                                       '<div class="checkin-card">' +
                                           priorityBannerHTML +
                                           '<div class="checkin-header">' +
                                               (airlineLogoUrl ? '<img src="' + airlineLogoUrl + '" alt="' + airlineName + '" class="checkin-airline-logo" onerror="this.onerror=null;this.src=\'' + DEFAULT_LOGO + '\';">' : '') +
                                               '<span class="checkin-airline-name">' + airlineName + '</span>' +
                                           '</div>' +
                                           '<h2 class="checkin-destination">' + destination + '</h2>' +
                                           '<div class="checkin-flight-details">' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">LET / FLIGHT</span>' +
                                                    '<span class="detail-value flight-number">' + flightNumber + '</span>' +
                                                '</div>' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">' + (displayData.is_departure ? 'POLAZAK' : 'DOLAZAK') + '</span>' +
                                                    '<span class="detail-value">' + formattedFlightTimeValue + '</span>' +
                                                '</div>' +
                                           '</div>' +
                                           '<div class="checkin-status-label">' +
                                                checkinIconSVG + // Add icon
                                                '<span>CHECK-IN / PRIJAVA</span>' +
                                           '</div>' +
                                       '</div>' +
                                       '<div class="current-datetime">' + // Moved time/date outside card
                                           '<div class="current-time">' + formatTime(currentTime) + '</div>' +
                                           '<div class="current-date">' + formatDate(currentTime) + '</div>' +
                                       '</div>' +
                                   '</div>';

                 contentRoot.innerHTML = contentHTML;

                 // Handle Notification Bar
                 if (currentSession.notification_text) {
                    notificationTextElement.textContent = currentSession.notification_text;
                    notificationBar.classList.remove('hidden');
                    notificationTextElement.style.animation = 'none';
                    void notificationTextElement.offsetWidth;
                    notificationTextElement.style.animation = '';
                 } else {
                    notificationBar.classList.add('hidden');
                    notificationTextElement.textContent = '';
                    notificationTextElement.style.animation = 'none';
                  }
              }

             // *** NEW Notice Rendering Function ***
             function renderNoticeContent() {
                 var displayData = currentSession.CustomFlightData || currentSession.Flight;
                 if (!currentSession || !displayData) {
                    renderDefaultContent();
                    return;
                 }

                 var airline = displayData.Airline;
                 var flightTimeValue = displayData.is_departure ? displayData.departure_time : displayData.arrival_time;
                 var formattedFlightTimeValue = formatFlightTime(flightTimeValue);
                 var airlineLogoRelativePath = airline && airline.logo_url && airline.logo_url.startsWith('/uploads/') ? airline.logo_url : null;
                 var airlineLogoUrl = airlineLogoRelativePath ? API_BASE_URL + airlineLogoRelativePath : (airline && airline.logo_url ? airline.logo_url : DEFAULT_LOGO);
                 var airlineName = airline ? airline.name : 'Nepoznata Aviokompanija';
                 var flightNumber = displayData.flight_number || '';
                 var destination = displayData.destination || '';
                 var notificationText = currentSession.notification_text || ''; // Get notification text

                 var priorityBannerHTML = currentSession.isPriority ? '<div class="priority-banner">PRIORITY</div>' : '';

                 var contentHTML = '<div class="checkin-display-container">' + // Reuse container
                                       '<div class="checkin-card">' + // Reuse card
                                           priorityBannerHTML +
                                           '<div class="checkin-header">' +
                                               (airlineLogoUrl ? '<img src="' + airlineLogoUrl + '" alt="' + airlineName + '" class="checkin-airline-logo" onerror="this.onerror=null;this.src=\'' + DEFAULT_LOGO + '\';">' : '') +
                                               '<span class="checkin-airline-name">' + airlineName + '</span>' +
                                           '</div>' +
                                           '<h2 class="checkin-destination">' + destination + '</h2>' +
                                           '<div class="checkin-flight-details">' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">LET / FLIGHT</span>' +
                                                    '<span class="detail-value flight-number">' + flightNumber + '</span>' +
                                                '</div>' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">' + (displayData.is_departure ? 'POLAZAK' : 'DOLAZAK') + '</span>' +
                                                    '<span class="detail-value">' + formattedFlightTimeValue + '</span>' +
                                                '</div>' +
                                           '</div>' +
                                           // Notice Status Label
                                           '<div class="notice-status-label">' +
                                                '<span class="notice-icon">⚠️</span>' + // Exclamation icon
                                                '<span>OBAVJEŠTENJE / PASSENGER NOTICE</span>' +
                                           '</div>' +
                                           // Notice Text Box with inner span for marquee
                                           '<div class="notice-text-box">' +
                                                '<span>' + notificationText + '</span>' + // Wrap text in span, no need for <br> with nowrap
                                           '</div>' +
                                       '</div>' +
                                       '<div class="current-datetime">' +
                                           '<div class="current-time">' + formatTime(currentTime) + '</div>' +
                                           '<div class="current-date">' + formatDate(currentTime) + '</div>' +
                                       '</div>' +
                                   '</div>';

                 contentRoot.innerHTML = contentHTML;

                 // Hide notification bar for notice sessions as text is in the main box
                 notificationBar.classList.add('hidden');
                 notificationTextElement.textContent = '';
                 notificationTextElement.style.animation = 'none';
             }

              // *** Boarding Rendering Function (Using Check-In Layout) ***
              function renderBoardingContent() {
                 var displayData = currentSession.CustomFlightData || currentSession.Flight;
                 if (!currentSession || !displayData) {
                    renderDefaultContent();
                    return;
                 }

                 var airline = displayData.Airline;
                 var flightTimeValue = displayData.is_departure ? displayData.departure_time : displayData.arrival_time;
                 var formattedFlightTimeValue = formatFlightTime(flightTimeValue);
                 var airlineLogoRelativePath = airline && airline.logo_url && airline.logo_url.startsWith('/uploads/') ? airline.logo_url : null;
                 var airlineLogoUrl = airlineLogoRelativePath ? API_BASE_URL + airlineLogoRelativePath : (airline && airline.logo_url ? airline.logo_url : DEFAULT_LOGO);
                 var airlineName = airline ? airline.name : 'Nepoznata Aviokompanija';
                 var flightNumber = displayData.flight_number || '';
                 var destination = displayData.destination || '';

                 var priorityBannerHTML = currentSession.isPriority ? '<div class="priority-banner">PRIORITY</div>' : '';

                 // Boarding Gate Icon (Example using SVG - replace with a better gate icon if available)
                 var boardingIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22 9v11H2V9c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2zm-4.6-4.4L16 6l-1.6-1.4c-.4-.4-1-.4-1.4 0l-1.6 1.4-1.4-1.4c-.4-.4-1-.4-1.4 0L7 6 5.6 4.6c-.4-.4-1-.4-1.4 0l-.6.6c-.4.4-.4 1 0 1.4L5 8h14l1.4-1.4c.4-.4.4-1 0-1.4l-.6-.6c-.4-.4-1-.4-1.4 0zM4 11h16v7H4v-7z"/></svg>';

                 var contentHTML = '<div class="checkin-display-container">' + // Reuse container class
                                       '<div class="checkin-card">' + // Reuse card class
                                           priorityBannerHTML +
                                           '<div class="checkin-header">' +
                                               (airlineLogoUrl ? '<img src="' + airlineLogoUrl + '" alt="' + airlineName + '" class="checkin-airline-logo" onerror="this.onerror=null;this.src=\'' + DEFAULT_LOGO + '\';">' : '') +
                                               '<span class="checkin-airline-name">' + airlineName + '</span>' +
                                           '</div>' +
                                           '<h2 class="checkin-destination">' + destination + '</h2>' +
                                           '<div class="checkin-flight-details">' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">LET / FLIGHT</span>' +
                                                    '<span class="detail-value flight-number">' + flightNumber + '</span>' +
                                                '</div>' +
                                                '<div class="detail-item">' +
                                                    '<span class="detail-label">' + (displayData.is_departure ? 'POLAZAK' : 'DOLAZAK') + '</span>' +
                                                    '<span class="detail-value">' + formattedFlightTimeValue + '</span>' +
                                                '</div>' +
                                           '</div>' +
                                           // Use boarding status and icon
                                           '<div class="checkin-status-label" style="color: #2dd4bf;">' + // Teal color for boarding
                                                boardingIconSVG +
                                                '<span>UKRCAVANJE / BOARDING</span>' +
                                           '</div>' +
                                       '</div>' +
                                       // Time/Date is now positioned via CSS in the container
                                   '</div>';
                                   // Add time/date outside the card but inside the container
                                   contentHTML += '<div class="current-datetime">' +
                                                      '<div class="current-time">' + formatTime(currentTime) + '</div>' +
                                                      '<div class="current-date">' + formatDate(currentTime) + '</div>' +
                                                  '</div>';


                 contentRoot.innerHTML = contentHTML;

                 // Handle Notification Bar
                 if (currentSession.notification_text) {
                    notificationTextElement.textContent = currentSession.notification_text;
                    notificationBar.classList.remove('hidden');
                    notificationTextElement.style.animation = 'none';
                    void notificationTextElement.offsetWidth;
                    notificationTextElement.style.animation = '';
                 } else {
                    notificationBar.classList.add('hidden');
                    notificationTextElement.textContent = '';
                    notificationTextElement.style.animation = 'none';
                 }
             }


            function updateDisplay() {
                if (currentError) {
                    renderError(currentError);
                } else if (currentSession) {
                    // *** Route rendering based on sessionType ***
                     if (currentSession.sessionType === 'check-in') {
                         renderCheckInContent();
                     } else if (currentSession.sessionType === 'boarding') {
                         renderBoardingContent();
                     } else if (currentSession.sessionType === 'notice') {
                         renderNoticeContent(); // Call the new notice render function
                     } else {
                         // Unknown session type, render default
                         console.warn("Unknown session type:", currentSession.sessionType);
                        renderDefaultContent();
                    }
                } else {
                    renderDefaultContent(); // Handles static content or welcome message
                }
            }


            // --- Data Fetching ---
            function fetchData() {
                if (!currentPageId) {
                    renderError("ID stranice nije definisan.");
                    return;
                }
                console.log('Fetching data for page:', currentPageId);

                var sessionFetched = false;
                var staticFetched = false;
                var sessionError = null;
                var staticError = null;

                function checkCompletion() {
                    if (sessionFetched && staticFetched) {
                        console.log('Both fetches complete.');
                        currentError = sessionError; // Only session error is critical
                        updateDisplay(); // Call the main update function
                    }
                }

                // Fetch session data
                var sessionXhr = new XMLHttpRequest();
                var sessionUrl = API_BASE_URL + '/api/display/active?page=' + currentPageId + '&t=' + Date.now();
                sessionXhr.open('GET', sessionUrl, true);
                sessionXhr.timeout = 15000; // Add timeout
                sessionXhr.onreadystatechange = function() {
                    if (sessionXhr.readyState === 4) {
                        sessionFetched = true;
                        if (sessionXhr.status === 200) {
                            try {
                                var sessions = JSON.parse(sessionXhr.responseText);
                                currentSession = sessions.length > 0 ? sessions[0] : null;
                                console.log('Session data:', currentSession);
                            } catch (err) {
                                console.error('Greška pri parsiranju sesije:', err);
                                sessionError = 'Greška pri obradi podataka sesije.';
                                currentSession = null;
                            }
                        } else if (sessionXhr.status !== 0) {
                            console.error('Greška pri dobavljanju sesije:', sessionXhr.status);
                            sessionError = 'Greška pri dobavljanju podataka (' + sessionXhr.status + ').';
                            currentSession = null;
                        }
                        checkCompletion();
                    }
                };
                 sessionXhr.onerror = function() {
                     console.error('Network error fetching session');
                     sessionFetched = true;
                     sessionError = 'Mrežna greška pri dobavljanju podataka.';
                     currentSession = null;
                     checkCompletion();
                 };
                 sessionXhr.ontimeout = function() { // Handle timeout
                     console.error('Session request timed out');
                     sessionFetched = true;
                     sessionError = 'Zahtev za sesijom je istekao.';
                     currentSession = null;
                     checkCompletion();
                 };
                sessionXhr.send();

                // Fetch static content
                var staticXhr = new XMLHttpRequest();
                var staticUrl = API_BASE_URL + '/api/content/page/' + currentPageId + '?t=' + Date.now();
                staticXhr.open('GET', staticUrl, true);
                staticXhr.timeout = 10000; // Shorter timeout for static content
                staticXhr.onreadystatechange = function() {
                    if (staticXhr.readyState === 4) {
                        staticFetched = true;
                        if (staticXhr.status === 200) {
                            try {
                                var staticData = JSON.parse(staticXhr.responseText);
                                currentStaticContent = (staticData && staticData.content && staticData.content.imageUrl) ? staticData.content : null;
                                console.log('Static content data:', currentStaticContent);
                            } catch (err) {
                                console.error('Greška pri parsiranju statičkog sadržaja:', err);
                                staticError = 'Greška pri obradi statičkog sadržaja.';
                                currentStaticContent = null;
                            }
                        } else if (staticXhr.status !== 0) {
                            console.warn('Greška pri dobavljanju statičkog sadržaja:', staticXhr.status);
                            staticError = 'Nije moguće dohvatiti statički sadržaj.';
                            currentStaticContent = null;
                        }
                         checkCompletion();
                    }
                };
                 staticXhr.onerror = function() {
                     console.warn('Network error fetching static content');
                     staticFetched = true;
                     staticError = 'Mrežna greška pri dobavljanju statičkog sadržaja.';
                     currentStaticContent = null;
                     checkCompletion();
                 };
                 staticXhr.ontimeout = function() { // Handle timeout
                     console.warn('Static content request timed out');
                     staticFetched = true;
                     // Don't set critical error for static content timeout
                     currentStaticContent = null;
                     checkCompletion();
                 };
                staticXhr.send();
            }

            // --- Clock Update ---
            function updateClock() {
                currentTime = new Date();
                var formattedTime = formatTime(currentTime);
                var formattedDate = formatDate(currentTime);

                // Update time/date display in active session view (Check-in, Boarding, Notice)
                var sessionTimeElement = document.querySelector('.checkin-display-container .current-time');
                var sessionDateElement = document.querySelector('.checkin-display-container .current-date');
                if (sessionTimeElement && sessionDateElement) {
                    sessionTimeElement.textContent = formattedTime;
                    sessionDateElement.textContent = formattedDate;
                }

                // Update time/date display in static/default Bento view
                var bentoTimeElement = document.querySelector('.bento-container .bento-time');
                var bentoDateElement = document.querySelector('.bento-container .bento-date');
                if (bentoTimeElement && bentoDateElement) {
                    bentoTimeElement.textContent = formattedTime;
                    bentoDateElement.textContent = formattedDate;
                }
            }

            // --- Initialization ---
            currentPageId = getQueryParam('page');
            if (!currentPageId) {
                renderError("Nije specificiran ID stranice u URL-u (npr. ?page=C1)");
            } else {
                updateClock();
                setInterval(updateClock, 1000);

                fetchData();
                setInterval(fetchData, REFRESH_INTERVAL);
            }

        })();
    </script>
</body>
</html>
